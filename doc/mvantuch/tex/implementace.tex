\chapter{Implementace portálu v Drupalu}
\label{chap:implementace-drupal}

Pro převedení stávajícího řešení na novou verzi bylo nutné vykonat několik kroků. Nejprve byla data z produkčního prostředí přesunuta na testovací server, kde bylo řešení zanalyzováno co se týče implementační stránky, neboť bylo možné k portálu přistupovat s administrátorským účtěm bez jakýchkoliv omezení. Jakmile byly stránky zanalyzovány, byl započat proces jejich aktualizace na novou verzi Drupalu při zachování veškerého obsahu. Tento postup se ukázal jako kontraproduktivní, neboť i když byl obsah stránek převeden vpořádku, bylo potřeba jej převést na kompletně odlišnou strukturu spolu s jinými typy obsahu a jinými cílovými poli. Proto bylo rozhodnuto, že data budou přesunuta ručně.

\section{Aktualizace Drupal 6 na Drupal 7}
Sedmá verze Drupalu komplexně přepracovala celý kód redakčního systému a zohlednila v té době relevantní požadavky na moderní \gls{cms}. Mnoho modulů bylo přesunuto přímo do jádra systému - například podpora vytváření vlastních polí obsahu, pro což byl v Drupalu 6 potřeba modul CCK (Content Creation Kit). Množství změn je jednoduše vidět i ve velikosti zdrojových souborů, kdy verze 7 obsahuje 12.8~MB zdrojového kódu oproti 3,7~MB u verze 6.

Kromě funkcionality přidané do jádra, které by bylo možné dosáhnout i za pomocí modulů v předchozí verzi, byly přepracovány i mnohé části funkcionality jádra systému~\cite{website:drupal-comparison}. Pro toto řešení jsou důležitá následující vylepšení:

\begin{itemize}
  \item podpora kešování za pomocí reverzní proxy (např. Varnish)
  \item Entity API - vytváření entit bez URL
  \item možnost přidávat pole ke všem entitám (uživatelé, slovníky, ...)
  \item podpora různých databází se stejným zdrojovým kódem v PHP (abstrakce nad dotazy do databáze)
  \item zlepšená podpora AJAX volání
  \item celkově propracovanější kód (vhodný pro vývoj dalších modulů)
\end{itemize}


V době práce na informačním systému již byl dostupný i Drupal verze 8, ale nebyl ještě plně stabilní. Některé jeho vlastnosti však byly zpětně implementovány jako modul pro Drupal 7 a mou snahou bylo identifikovat jakékoliv takovéto moduly (například NavBar, který poskytuje responsivní administrační panel, filtrace modulů, či administrační téme Ember postavené na SASS). 

\begin{table}
  \caption{Porovnání verzí modulů mezi Drupalem 6 a 7}
  \begin{tabular}{ | p{5cm} | p{2.5cm} | p{2.5cm} | c | }
    \hline 
    Jméno modulu & Drupal 6 & Drupal 7 & stav  \\ \hline 
    Backup and Migrate & 2.7 & 2.7 & \checkmark \\ \hline
    Colorbox & 1.6 & 2.4 & \checkmark \\ \hline
    CCK & 2.9 & jádro & \checkmark \\ \hline
    Custom Breadcumbs & 1.5 & 1.x-alpha3 & \\ \hline
    DB Maintenance & 1.4 & 1.1 & \checkmark \\ \hline
    DHTML Menu & 3.5 & 1.0-beta1 & \\ \hline 
    Email Field & 1.4 & 1.2 & \checkmark \\ \hline
    File (Field Paths & 1.5 & 1.0-beta4 & \\ \hline
    FileField & 3.11 & jádro & \checkmark \\ \hline
    Front Page & 1.3 & 2.4 & \checkmark \\ \hline
    ImageAPI & 3.11 & jádro & \checkmark \\ \hline
    ImageCache & 2.0-rc1 & jádro & \checkmark \\ \hline
    IMCE & 2.5 & 1.7 & \checkmark \\ \hline
    IMCE Wysiwyg bridge & 1.1 & 1.0 & \checkmark \\ \hline
    jCarousel & 2.6 & 2.6 & \checkmark \\ \hline
    Link & 2.10 & 1.1 & \checkmark \\ \hline
    Localization Update & 2.10 & 1.1 & \checkmark \\ \hline
    Menu Attributes & 2.0-beta1 & 1.0-rc2 & \checkmark \\ \hline
    Menu Block & 2.4 & 2.3 & \checkmark \\ \hline
    Pathauto & 1.6 & 1.2 & \checkmark \\ \hline
    Taxonomy Breadcrumb & 1.1 & - & \\ \hline
    Token & 1.19 & 1.5 & \checkmark \\ \hline
    Transliteration & 3.1 & 3.1 & \checkmark \\ \hline
    Views & 2.16 & 3.7 & \\ \hline
    Views Search & 1.0 & - & \\ \hline
    WYSIWYG & 2.4 & 2.2 & \checkmark \\ \hline
  \end{tabular}
\end{table}

Funkcionalita některých z modulů byla v sedmé verzi přesunuta přímo do jádra Drupalu a proto nebylo jejich využití již potřebné - byly využity jejich ekvivalenty z jádra. Kromě těchto byly odebrány i další moduly, kdy některé nejsou pro novou verzi vůbec dostupné. Dále byly odstraněny moduly, jejichž využití již postrádalo smysl. Z důvodu změny a zjednodušení struktury menu již nebylo potřeba mnoho modulů, které umožňovaly složitá menu zobrazovat uživatelům. Zároveň bylo odstraněno několik modulů, které nebyly na stránkách vůbec využity a zbytečně zpomalovaly běh portálu. Následuje seznam těchto modulů s jejich krátkým popisem.

\subsection{Odebrané moduly (nedostupné)}
Z důvodu převážného vyvíjení Drupalu komunitou nebyly všechny moduly dostupné pro Drupal 6 vyvinuty i pro Drupal 7 - většinou z důvodu nepotřebnosti daných modulů, kdy u většiny užitečných modulů nová verze existuje.

\subsubsection*{Views Search \hfill \emph{https://drupal.org/project/views\_search}}
Rozšiřuje funkcionalitu Views a jejich obsahových filtrů.

\subsection{Odebrané moduly (definující strukturu předchozího řešení)}
Předchozí struktura webu byla v mnohém odlišná a k její implementaci bylo využito několik modulů, které mohly být pro nepotřebnost vypnuty a odinstalovány. 

\subsubsection*{Front Page \hfill \emph{https://drupal.org/project/front}}
Slouží k nastavení výchozí stránky pro různé uživatelské role. Z důvodu plánování kompletně nové implementace domovské stránky byla tato funkcionalita prozatím odstraněna a může být případně přidána v čase implementace dané části portálu.

\subsubsection*{Menu Attributes \hfill \emph{https://drupal.org/project/menu\_attributes}}
Umožňuje přiřazení attributů k položkám menu. Ty pak mohou být použity buď pro stylování, nebo navázány na JavaScript.

\subsubsection*{Taxonomy Breadcrumb \hfill \emph{https://drupal.org/project/taxonomy\_breadcrumb}}
Generuje drobečkovou navigaci za pomoci slovníků definovaných v systému a jejich hierarchie. Hierarchie tím pádem může být velmi jendoduše upravena - toto však již není po úpravě systému potřeba s ohledem na zjednodušenou strukturu.

\subsubsection*{Custom Breadcrumbs \hfill \emph{https://drupal.org/project/custom\_breadcrumbs}}
Umožňuje detailní nastavení drobečkové navigace.

\subsubsection*{DHTML Menu \hfill \emph{https://drupal.org/project/dhtml\_menu}}
Mění funkcionalitu menu - při prvním kliknutí se namísto přesunutí na danou stránku pouze rozbalí menu s potomky daného odkazu a až při druhém kliknutí se přejde na danou stránku - tato funkcionalita zřejmě nebyla využívána.

\subsection{Nevyužité moduly}
Několik modulů sice bylo povoleno, ale nebyly nikde v systému využity a proto byly odstraněny.

\subsubsection*{jCarousel \hfill \emph{https://drupal.org/project/jcarousel}}
Slouží k propojení se stejnojmennou JavaScriptovou knihovnou poskytující zobrazení obrázků v ovladatelném ,,kolotoči''. S ohledem na aktuální absenci jakékoliv grafiky byl modul shledán nepotřebným.
 
\subsubsection*{Colorbox \hfill \emph{https://drupal.org/project/colorbox}}
Podobně jako jCarousel slouží k propojení s knihovnou určenou ke zobrazování obrázků a ani tento modul nebyl aktivně využíván.

\section{Nově přidané moduly}

\subsubsection*{Features \hfill \emph{https://drupal.org/project/features}} 
\label{subsec:features}
Jak je popsáno v kapitole~\ref{chap:vyvoj}, Features slouží k ulehčení vývoje a správy nastavení stránek postavených na Drupalu. Základní myšlenkou je třívrstvé rozvržení systému, v první úrovni je jádro a jeho moduly, ve druhé rozšiřující moduly (tzv. Contrib) a ve třetí jsou rysy (Features), které v sobě zapouzdřují samotné nastavení stránek. Ačkoliv se jedná také o moduly, jsou generovány systémem na stránce \texttt{admin/structure/features}. Zde je možné buď vytvořit nový rys, či spravovat ty stávající. Ty mohou být v několika stavech závisejících na aktuálním nastavení systému. Pokud bylo v sytému něco změněno od chvíle, kdy byl rys vygenerován a povolen (případně pouze povolen, pokud byl přenesen z jiného serveru), je možné dané změny buď vrátit ke stavu definovanému v rysu, nebo rys aktualizovat na novou verzi.

\subsubsection*{Features \hfill \emph{https://drupal.org/project/features\_extra}} 
Jelikož modul Features v sobě implementuje pouze základní funkcionalitu exportu typů obsahu a poskytuje \gls{api} pro další moduly, některé prvky webu nejsou v základu exportovatelné. Tento modul možnosti exportu rozšiřuje o několik dalších možností, ze kterých pro tento projekt byla důležitá možnost exportovat nastavení umístění bloků.

\subsubsection*{Media \hfill \emph{https://drupal.org/project/media}}
\gls{cms} systém Drupal v základu poskytuje pouze jednoduchou funkcionalitu práce s obrázky. Zvuk, video i dokumenty nejsou v aktuální verzi (7.x) podporovány vůbec. Zároveň uživatelé nemají mnoho možností operovat se soubory, které nahráli na server a tím pádem jsou často nuceni obsah opětovně nahrávat, čímž docházi k duplikaci. Tyto a mnohé další problémy se snaží řešit projekt Media, poskytující uživatelům srozumitelné rozhraní a unifikaci práce s různými typy multimediálního obsahu a zároveň správu veškerého obsahu nahraného na server. Pro svůj běh vyžaduje modul File Entity, který poskytuje možnosti práce se soubory jako entitami v systému.

\subsubsection*{Workbench \hfill \emph{https://drupal.org/project/workbench}}
\label{subsec:workbench}
Administrace Drupalu je mnohdy kritizována pro její nízkou uživatelskou přívětivost a složitost, čemuž se snaží ulehčit modul Workbench. Přihlášenému uživateli s právem administrace, či správy obsahu je umožněno přistoupit ke stránkám postavených na modulu Views a poskytujících přehled obsahu stránek - ať už se jedná o všeobecně nejnovější obsah, nebo o obsah naposledy upravený daným uživatelem. Tato funkcionalita je dále rozšířena, jak je popsáno v kapitole \ref{chap:vyvoj}.

\subsubsection*{Workbench Media \hfill \emph{https://drupal.org/project/workbench\_media}}
Zatímco modul Workbench poskytuje pohled na obsah stránek, Workbench Media, jak již název nápovídá, přidává propojení s modulem Media a tím pádem pohled na mediální obsah daného uživatele. 

\section{Téma vzhledu a jeho rozložení}
Pro rozvržení stránek bylo využito tématu vzhledu Omega ve verzi 4. Narozdíl od předchozích verzí, které poskytovaly uživatelům komplexní administrační rozhraní pro nastavení rozvržení stránky, byla tato možnost z verze 4 odstraněna a nahrazena využitím knihovny SUSY (viz. sekce~\ref{sec:technologies}). Veškerá rozvržení jsou proto implementována přímo v kódu a v administračním rozhraní jsou určovány až pozice jednotlivých bloků Drupalu. 

\begin{figure}[htp] 
  \centering{\includegraphics[scale=0.23]{img/page-layout-crop.pdf}}
  \caption{Rozvržení stránky}
  \label{fig:rozvrzeni-stranky}
\end{figure}  

Jak lze vidět na obrázku \ref{fig:rozvrzeni-stranky}, je stránka rozdělena na čtyři hlavní bloky - hlavičku, postranní panel, obsah a patičku. Poměr mezi postranním panelem a obsahem byl určen za použití knihovny SUSY a media queries. 

\begin{description}
  \item[Telefon] (velikost okna do 44em) \hfill \\
  Postranní panel zabírá celou šířku a za ním následuje obsah.
  \item[Tablet + standart] (velikost okna mezi 44em a 100em) \hfill \\
  Postranní panel a obsah jsou zobrazeny v poměru 1 : 3.
  \item[Širokoúhlý monitor] (velikost okna nad 100em) \hfill \\
  Postranní panel a obsah jsou zobrazeny v poměru 1 : 4.  
\end{description}

\section{Nasazení (deployment) a jeho možnosti}

Pro správu % TODO \gls{deployment} 
je využíván nástroj Phing (kapitola ..), umožňující definování pravidel v souboru build.xml. Kromě tohoto souboru je také dostupný soubor \texttt{phing/default.build.properties} obsahující výchozí nastavení projektu. Při první inicializaci jakéhokoliv cíle (target) se zkontroluje přítomnost souboru \texttt{build.properties} a v případě jeho absence se na jeho místo zkopíruje výše zmíněný soubor obsahující výchozí hodnoty. Pokud soubor není dostupný a není potřeba vytvářet instalaci, je vhodné spustit příkaz \texttt{phing void} který pouze připraví tento konfigurační soubor. 

V konfiguračním souboru je vhodné zadat nastavení prostředí, na kterém se bude portál instalovat (cesty k souborům, nastavení databáze a pod.) - více informací je v samotném souboru.

\begin{description}
  \item[void] \hfill \\
  Pouze provede inicializaci konfiguračních souborů a ukončí se.  
  \item[guacamole] 
  Vytvoří konfigurační soubory projektu Guacamole ve správných složkách (je zkopírován soubor \texttt{phing/default.guacamole.properties}.
  \item[deploy]
  Překopíruje aktuální moduly na správné místo a zajistí správné nastavení portálu dle aktuálního nastavení (převážně využití Features).
  \item[install]
  Provede kompletní instalaci portálu dle nastavení v konfiguračních souborech - překopíruje moduly a témata specifická pro toto řešení, stáhne potřebné zdrojové kódy Drupalu z internetu a nainstaluje Drupal, kterému následně nastaví správné téma vzhledu a povolí potřebné moduly.
\end{description}

\section{Výkonové optimalizace}
Ideálně si projít nějaké výzkumy Googlu ohledně odezvy a jejího dopadu na uživatele

Popsat agregaci JS, CSS a podobne 
\cite{website:drupal:optimizing}

\chapter{Implementace připojení ke vzdálené ploše}
\label{chap:implementace-guacamole}
Implementace připojení ke vzdálené ploše probíhala v několika fázích. Nejdříve bylo potřeba spustit řešení Guacamole lokálně a ujistit se, že je použitelné pro naše potřeby. Bylo také nutné analyzovat, jaké všechny možnosti poskytuje a které vlastnosti jsou potřebné a které přebytečné. Jako přebytečné byly idnetifikovány vlastnosti poskytující správu uživatelů, připojení a jejich skupin. Dále je implementována podpora klávesnici na obrazovce, ukládání snímků obrazovky a mnoho dalších rozšířených možností, které nebyly do základní verze vyžadovány a byly spíše kontraproduktivní s ohledem na zvýšení komplexnosti kódu a debugování celého řešení. 

Jakmile byla funkčnost ověřena, bylo nutné celou klientskou část řešení přesunout do modulu v Drupalu a upravit pro tamější podmínky. Bylo nutné změnit HTML výstup, kdy Drupal si v základu buduje strukturu pomocí několika šablonových souborů pro stránku, tělo a pod. Bylo nutné přidat JavaScriptové knihovny z Guacamole, odstranit nepotřebný kód a upravit vše k funkčnosti v prostředí s použitím CORS. 

Guacamole také poskytuje mnohá nastavení a pro ulehčení byla do modulu přidána administrační stránka, která přímo zapisuje do konfiguračního souboru Guacamole a tím eliminuje potřebu připojení na server. 

\section{Ostranění autentizace uživatelů a vytvoření vlastní autorizace}
Guacamole v základu poskytuje API pro správu uživatelských účtů a jejich připojení. Jsou implementovány dvě metody, jedna spoléhá na uložení dat do konfiguračního souboru, zatímco druhá pracuje s MySQL databází. Obě rozšiřují třídu \emph{SimpleAuthenticationProvider}, ke které přidávají potřebnou funkcionalitu. 

Pro potřeby tohoto projektu však bylo potřeba vždy pouze jediné připojení, pro jednotlivé uživatele se měnilo pouze jejich přihlašovací jméno. Byla vytvořena nová třída \emph{DrupalAuthenticationProvider}, která načítá adresu serveru a port přímo z konfiguračního souboru pro všechna připojení a vrací je Guacamole k dalšímu zpracování. 

Pro nastavení přihlašovacích údajů je potřeba se nejdříve k serveru přihlásit. Pro minimalizaci úkonů potřebných ke každému připojení ke vzdálené ploše a také k zjednodušení celého procesu si musí každý uživatel portálu uložit své přihlašovací údaje do svého profilu, odkud jsou pak použity při přihlášení ke Guacamole Servletu. K tomu je použito dvou služeb - \emph{connect} a {login}. Proces je znázorněn na diagramu \ref{fig:login_process}. 

Komunikace je započata přímo v klientském prohlížeči z JavaScriptu. Po přístupu na stránku /aspi je nejdříve kontaktována pomocí technolie AJAX stránka /aspi/ajax na portálu, která se připojí ke servletu Login. Guacamole Servlet si vytvoří nové \gls{session} a jeho identifikátor odešle zpět PHP kódu. Pokud vše proběhne v pořádku, je identifikátor sezení odeslán pomocí set-cookie hlavičky zpět stránce /aspi, kde si informaci uloží prohlížeč jako cookie pro pozdější komunikaci. V případě jakékoliv chyby je chybové hlášení vypsáno na obrazovce a zalogováno v systému bez jakýchkoliv dalších pokusů o připojení, uživatel je tedy nucen buď stránku obnovit, nebo kontaktovat správce stránek. Pokud však vše proběhne v pořádku, je inicializována smyčka přímých volání služby \emph{tunnel} poskytované Guacamole Servlet kontejnerem za pomocí technologie CORS. Komunikace probíhá za pomocí Guacamole protokolu a ten je poté konvertován na grafický výstup na obrazovce uživatele, který je od této chvíle schopen pomocí myši a klávesnice ovládat vzdálenou plochu a tím i gls{aspi}.

\begin{figure}[]
  \includegraphics[scale=0.85]{img/login-process-crop.pdf}
  \caption{Proces připojení ke vzdálené ploše}
  \label{fig:login_process}
\end{figure}  

\section{Přesun JavaScript kódu a stylů do modulu Drupalu}
Pro ulehčení správy \gls{session}, které by jinak muselo být synchronizováno mezi dvěma stránkami, byl veškerý kód stránky z Guacamole JAVA projektu přesunut do modulu v drupalu. Do složky js/lib byly přesunuty všechny zdrojové kódy z knihovny Guacamole-js a byla vytvořena nová stránka /aspi poskytující stejnou funkcionalitu jako JAVA modul. Spolu s javascriptem bylo nutné přesunout i základní css styly pro zachování formátu vykreslování okna vzdálené plochy. Jak knihovny, tak styly jsou importovány pouze na stránce /aspi pro snížení náročnosti běhu celé platformy, která by jinak byla nucena načítat nepotřebné soubory. 

Drupal v základu vytváří komplexní html výstup včetně loga, základní struktury a podobně, kdežto guacamole vyžaduje pro vykreslení vzdálené plochy velmi jednoduchou strukturu obsahující prakticky jen plátno pro vykreslování výstupu a nastavení v hlavičce. Zatímco údaje do hlavičky lze přidat jednoduše pomocí implementace hook\_api drupalu (viz. sekce \ref{sec:technologies}), změnu výstupu bylo nutné implementovat pomocí kombinace několika technik. Téma vzhledu \emph{Omega} ve verzi 4.x poskytuje funkcionalitu rozdílných rozvržení (layouts) dostupných pro různé části stránky. Tato možnost lze skombinovat s modulem \emph{Context} a jeho podmodulem \emph{Context Omega}, který poskytuje přemostění mezi modulem a tématem vzhledu a tím i možnost změny rozvržení podle definovaných pravidel. V případě tohoto projektu stačilo nadefinovat pravidlo změny pro url /aspi na které se automaticky přepne rozvržení na minimalistické rozvržení nazvané \emph{Guacamole}. Toto nastavení je i exportováno do konfiguračního modulu esf\_feature.

\section{Implementace CORS}
Pro možnost komunikace mezi více doménami bylo potřeba implementovat CORS (viz. sekce \ref{sec:technologies}). Hlavní změna je u zpracování požadavků na straně serveru, k čemuž musela být do projektu přidána a nastavena knihovna k jeho zpracování. Pro JAVA EE byla využita knihovna CORS filter od [d]zhuvinov  [s]oftware\cite{website:cors-filter}, která tuto implementaci poskytuje ve formě knihovny. Na stránkách je i detailně popsáno nastavení a použití, kdy v připadě tohoto serveru bylo nutno omezit zdroj CORS požadavků na jedinou doménu a více nebylo nutno se o bezpečnost obávat.

Druhá část implementace je umožnění cross-domain požadavků v JavaScriptu. Knihovna Guacamole-js musela být lehce přepsána v místech, kde byla použita volání XMLHttpRequest, která jsou v tomto případě volána asynchronně. Použité řešení bohužel nelze aplikovat na \gls{ie}, neboť XDomainRequest nepodporuje asynchronní zpracování a bude nutné toto řešení ještě přepracovat do funkční podoby.

\section{Implementace úpravy nastavení z administrace portálu}
Guacamole typicky poskytuje nastavení pomocí konfiguračního souboru umístěného buď ve složce instalace, nebo v domácí složce uživatele, který program spouští. Jelikož je ke změně těchto konfiguračních souborů nutné přistupovat přímo k serveru, rozhodl jsem se tuto administrační část přepracovat a zpřístupnit přímo z administrace portálu. Ta nabízí dvě základní stránky. Na stránce Nastavení (/config/esf/settings) je možné upravit základní nastavení projektu jako je URL adresa pro připojení ke Guacamole Servlet službám či právě přístup ke konfiguračnímu souboru. Ten se typicky jmenuje guacamole.properties a nachází se ve složce /srv/guacamole/. Je nutné se ujistit, že jak Guacamole Servlet (TomCat) tak \gls{esf} Portál (Apache) mají k souboru přístup a mohou jej upravovat.

Na stránce nastavení Připojení ke vzdálené ploše (\texttt{/config/esf/remote}) lze za předpokladu, že je vše správně nastaveno, upravovat nastavení Guacamole samotného a url pro připojení k serveru vzdálené plochy - což je v našem případě ASPI. Dále je nutné nastavit port pro připojení ke Guacd démonovi poskytujícímu proxy pro připojení ke vzdálené ploše, uživatelské jméno a heslo je však převzato z nastavení každého jednotlivého uživatele.

\section{Vývoj tématu vzhledu}
Implementace vzhledu probíhá na dvou úrovních. 
\begin{enumerate}
  \item Je potřeba generovat vhodný HTML kód. K tomu v Drupalu slouží systém přepisování šablonovacích souborů (přípona .tpl.php) pro jednotlivé prvky webu. V základu poskytuje Drupal stromovou strukturu, začínající u celého dokumentu (html.tpl.php), který obsahuje všechen obsah včetně hlaviček, a pokračující přes stránku (page.tpl.php) až po jednotlivé elementy (např. fieldset.tpl.php). Většina těchto šablon je definována přímo v jádru systému a všechny lze jednoduchým způsobem (na základě jména) přepsat. Zároveň je možné vytvářet úplně nové šablony. Šablonám lze zároveň i upravit data, která do nich budou vložena a to za pomoci implementace funkcí \_preprocess a \_process a jejich vložení do kódu tématu vzhledu. 
  Další způsob, jak změnit výstup html je přepsání funkcí formátujících jednoduché elementy stránky (například seznam elementů ul). Typicky jsou tyto prvky generovány funkcí theme([jméno elementu], [proměnné]), která může být přepsána buď v modulu, nebo tématu vzhledu, jako [jméno modulu]\_[jméno elementu]() - například \texttt{function omega\_fieldset(\$variables)}. Modul Omega nad tímto rozhraním navíc poskytuje možnosti všechny tyto funkce vkládat do samostatných souborů pojmenovaných dle daných konvencí, čímž dále zpřehledňuje výsledný kód (výše zmíněný kód by byl umístěn v souboru \texttt{theme/container.theme.inc}).
  \item Na HTML kód se nanášejí \gls{css} styly. Jak je popsáno v sekci \ref{subsec:sass}, je výhodnější využívat nástroj SASS, který je do jazyka \gls{css} kompilován a poskytuje více možností. Vývoj probíhá dle standartů určených v tématu vzhledu Omega (viz. \ref{subsec:omega}) a je definován v rámci několika SASS souborů, kde do každého z nich je seskupena určitá množina nastavení.
\end{enumerate}

\begin{figure}[]
  \includegraphics[scale=0.85]{img/drupal-theme-architecture-crop.pdf}
  \caption{Architektura vykreslení HTML kódu stránky}
  \label{fig:theme_architecture}
\end{figure}  

V repozitáři je již dostupná kompilovaná verze \gls{css} souborů, ale v případě nutnosti je možné je znovu vygenerovat. K tomu je nutno mít nainstalováno \gls{ruby}, COMPASS (viz sekce \ref{subsec:compass} a \gls{bundler}.

\begin{enumerate}
  \item \texttt{\$ sudo gem install bundler}
  \item \texttt{\$ bundle install}
  \item \texttt{\$ compass watch}
\end{enumerate}

COMPASS bude od této chvíle sledovat obsah složky a v případě jakýchkoliv změn automaticky aktualizovat výsledné CSS soubory.
